#!/usr/bin/env bash

# ========================
# Script: analysis
# Author: Danyan Chen
# Student id : 24063952
# Description:
#   
# ========================


# ---------- Get parameters & Validate parameters -------------
file_path=$1

if test $# -ne 1  
then 
    echo "Error: Expected 1 argument, but got $#, usage: ./anlysis <file_path>" >&2
    exit 1
fi


if test ! -s "$file_path"
then
    echo "Error: The specified input file '$file_path' does not exist or is empty." >&2
    exit 1
fi

# ---------- Q1 The most popular game mechanics is Hand Management found in xx games -------------
gawk '
BEGIN{
    FS ="\t"
}

{
    # Incase some empty field with multiple space
    gsub(/[ \t\r\n]+/, "", $13)

    # $13 is the column mechanics
    # skip header and skip the empty field
    if(NR>1 && $13 !=""){

        # split(string, array, separator)
        split($13, row_values, "," )

        for(i=1;i<=length(row_values);i++){

            # Replace the possible space with ""
            gsub(/^ +| +$/,"",row_values[i])
            count[row_values[i]]++
        }

    }
}

END{
    max_count = 0

    for (i in count){
        if(count[i] > max_count){
            max_count = count[i]
            max_value = i
        }
    }
    print "The most popular mechanic is", max_value, "found in", max_count, "games"


}
' "$file_path"